description	"nyc-trees-app"

start on ({{ "vagrant-mounted" if developing_or_testing else "local-filesystems and net-device-up IFACE!=lo" }})
stop on shutdown

respawn
setuid nyc-trees
chdir {{ app_home }}

exec envdir /etc/nyc-trees.d/env gunicorn \
	-b 127.0.0.1:8000 \
	--log-file "{{ app_log }}" \
	{% if developing_or_testing -%}
	--debug \
	--timeout 1800 \
	--reload \
	{% else -%}
	--workers {{ 2 * ansible_processor_count }} \
	--timeout 60 \
	--preload \
	{% endif -%}
	nyc_trees.wsgi
